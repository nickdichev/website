---
/**
 * Toggle button for the lava lamp background effect.
 * Persists preference to localStorage.
 */
---

<button
  id="lavaLampToggle"
  class="w-10 h-10 flex items-center justify-center rounded-md hover:bg-surface"
  title="Toggle background effect"
>
  <svg
    class="h-7 w-7"
    fill="currentColor"
    viewBox="0 0 50 50"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path d="M31.98 49H18.02c-.76 0-1.25-.83-.87-1.5l2.32-4.57c.33-.58.35-1.29.05-1.89L17.5 37h15l-2.02 4.04c-.3.6-.28 1.31.05 1.89l2.32 4.57C33.23 48.17 32.74 49 31.98 49zM21.5 22c4.5 0 3.32 5.99 11.5 7 .53.06 1.05.09 1.53.15L31 7h-6c0 0 0 5-4 7-1.32.66-2.42.99-3.3 1.14l-2.58 16.2c-.08.43-.01.87.18 1.26l1.2 2.4h11.72c-.11-.31-.18-.65-.22-1-.5-4.09-3-5-6.5-5-1.93 0-3.28-1.68-3.28-3.61C18.22 23.45 19.57 22 21.5 22zM27 16c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2S25.9 16 27 16zM30.3 2.64C30.13 1.69 29.3 1 28.34 1h-6.68c-.96 0-1.79.69-1.96 1.64L19.32 5h11.36L30.3 2.64z"/>
  </svg>
</button>

<style>
  #lavaLampToggle {
    opacity: 1;
    transition: opacity 0.2s;
  }

  #lavaLampToggle[data-disabled="true"] {
    opacity: 0.4;
  }

  #lavaLampToggle[data-disabled="true"] .lava-blob {
    opacity: 0.2;
  }
</style>

<script is:inline>
  // Initialize lava lamp state from localStorage
  const lavaLampEnabled = (() => {
    if (typeof localStorage !== "undefined" && localStorage.getItem("lavaLamp") !== null) {
      return localStorage.getItem("lavaLamp") === "true";
    }
    // Default to enabled
    return true;
  })();

  // Apply initial state
  function applyLavaLampState(enabled) {
    const container = document.querySelector("[data-lava-lamp]");
    const toggle = document.getElementById("lavaLampToggle");

    if (container) {
      container.style.display = enabled ? "" : "none";
    }
    if (toggle) {
      toggle.setAttribute("data-disabled", !enabled);
      toggle.setAttribute("title", enabled ? "Disable background effect" : "Enable background effect");
    }
  }

  applyLavaLampState(lavaLampEnabled);
  window.localStorage.setItem("lavaLamp", lavaLampEnabled);

  // Handle toggle click
  const handleLavaLampToggle = () => {
    const currentState = localStorage.getItem("lavaLamp") === "true";
    const newState = !currentState;

    localStorage.setItem("lavaLamp", newState);
    applyLavaLampState(newState);
  };

  document.getElementById("lavaLampToggle")?.addEventListener("click", handleLavaLampToggle);
</script>
